<p-growl [(value)]="msgs"></p-growl>

<div class="ui-grid-col-12" *ngIf="loggedCustomer && loggedCustomer.admin">
  <div class="ui-g">
    <div class="ui-g-10" align="center" style="padding-left: 20em;">
      <h1>Utenti</h1>
    </div>
    <div class="ui-g-2">
      <button type="button" pButton icon="fa fa-plus" (click)="showDialogToAdd()" label="Aggiungi Utente" style="margin-top: 1em;"></button>
    </div>
  </div>
</div>

<div align="center" *ngIf="loggedCustomer && !loggedCustomer.admin">
  <h1 *ngIf="customers[0]">Profilo Personale di {{customers[0].firstName}}</h1>
</div>

<div class="ui-grid-col-12" style="padding-top: 2em;" align="center" *ngIf="loggedCustomer">
  <p-table [columns]="cols" film-table [value]="customers" #ct [globalFilterFields]="['_id','title','text']">
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th style="width: 250px;">
          Foto
        </th>
        <th *ngFor="let col of columns">
          {{col.header}}
        </th>
        <th style="width: 7em">
          Dettaglio Richieste
        </th>
        <th style="width: 7em" *ngIf="loggedCustomer.admin">
          Gestione Utente
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-customer let-columns="columns">
      <tr>
        <td style="width: 250px;">
          <img src="assets/showcase/images/customer/{{customer.id}}.png" style="display:inline-block;margin:5px 0 0 5px"
            width="200">
        </td>
        <td *ngFor="let col of columns">
          {{customer[col.field]}}
        </td>
        <td>
          <p-button icon="fa fa-search" (onClick)="goToListaRichiesteCustomer(customer.firstName)"></p-button>
        </td>
        <td *ngIf="loggedCustomer.admin">
          <p-button icon="fa fa-cog" (onClick)="manageUser(customer)"></p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="cols.length+1">
          Nessun Utente Trovato
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog [(visible)]="displayDialog" closable="true" [responsive]="true" [modal]="true" [width]="900" [positionTop]="250">
  <p-header>
    Dettaglio Utente
  </p-header>
  <form name="form" #fRichieste="ngForm">
    <div class="ui-g ui-fluid" style="padding-bottom: 2em" *ngIf="loggedCustomer && customer">
      <div class="ui-g-12">
        <div class="ui-g-3">
          <label>Nome:</label>
        </div>
        <div class="ui-g-3">
          <input pInputText [disabled]="!loggedCustomer.admin" id="nome" name="nome" [(ngModel)]="customer.firstName"
            style="width: 100%" />
        </div>
        <div class="ui-g-3">
          <label>Cognome:</label>
        </div>
        <div class="ui-g-3">
          <input pInputText [disabled]="!loggedCustomer.admin" id="cognome" name="cognome" [(ngModel)]="customer.lastName"
            style="width: 100%" />
        </div>
      </div>
      <div class="ui-g-12">
        <div class="ui-g-3" *ngIf="!newCustomer">
          <label>N. Richieste:</label>
        </div>
        <div class="ui-g-3" *ngIf="!newCustomer">
          <p-spinner [disabled]="!loggedCustomer.admin" size="30" id="richieste" name="richieste" [(ngModel)]="customer.numeroRichieste"
            [max]="100" [min]="0" [step]="1" style="width: 100%"></p-spinner>
        </div>
        <div class="ui-g-3" *ngIf="!newCustomer && !showChangePassword && !loggedCustomer.admin">
          <label></label>
        </div>
        <div class="ui-g-3" *ngIf="!newCustomer && !showChangePassword">
          <button type="button" pButton class="ui-button-info" icon="fa fa-pencil-square-o" (click)="showChangePassword = true;"
            label="Modifca Password" style="font-size: 15px !important; height: 40px;"></button>
        </div>
        <div class="ui-g-3" *ngIf="!newCustomer && !showChangePassword && customer.admin && loggedCustomer.admin">
          <button type="button" pButton class="ui-button-warning" icon="fa fa-unlock" (click)="changeCustomerRole(customer, false)"
            label="Rimuovi Admin" style="font-size: 15px !important; height: 40px;"></button>
        </div>
        <div class="ui-g-3" *ngIf="!newCustomer && !showChangePassword && !customer.admin && loggedCustomer.admin">
          <button type="button" pButton class="ui-button-warning" icon="fa fa-lock" (click)="changeCustomerRole(customer, true)"
            label="Assegna Admin" style="font-size: 15px !important; height: 40px;"></button>
        </div>
        <div class="ui-g-12" *ngIf="showChangePassword">
          <div class="ui-g-3" *ngIf="!newCustomer">
            <label>Password Attuale:</label>
          </div>
          <div class="ui-g-9" *ngIf="!newCustomer">
            <input pInputText id="psw" name="psw" type="password" [(ngModel)]="customerPassword" style="width: 100%" />
          </div>
          <div class="ui-g-3" *ngIf="!newCustomer">
            <label>Nuova Password:</label>
          </div>
          <div class="ui-g-3" *ngIf="newCustomer">
            <label>Password:</label>
          </div>
          <div class="ui-g-9">
            <input pInputText id="newPsw" name="newPsw" type="password" [(ngModel)]="newCustomerPassword" style="width: 100%" />
          </div>
          <div class="ui-g-3" *ngIf="!newCustomer">
            <label>Conferma Nuova Password:</label>
          </div>
          <div class="ui-g-3" *ngIf="newCustomer">
            <label>Conferma Password:</label>
          </div>
          <div class="ui-g-9">
            <input pInputText id="repeatedNewPsw" name="repeatedNewPsw" type="password" [(ngModel)]="repeatedNewCustomerPassword"
              style="width: 100%" />
          </div>
        </div>
      </div>
    </div>
    <p-footer>
      <div class="ui-dialog-buttonpane ui-helper-clearfix" *ngIf="loggedCustomer">
        <div class="ui-g-6" *ngIf="!newCustomer && loggedCustomer.admin && !showChangePassword">
          <button type="button" pButton class="ui-button-danger" icon="fa fa-trash-o" (click)="delete()" label="Elimina Utente"></button>
        </div>
        <div class="ui-g-6" *ngIf="!newCustomer && showChangePassword">
          <button type="button" pButton class="ui-button-info" icon="fa fa-times" (click)="annul()" label="Annulla Modifica"></button>
        </div>
        <div class="ui-g-12" *ngIf="newCustomer" align="center">
          <button type="submit" pButton class="ui-button-success" icon="fa fa-check" (click)="save()" label="Salva Utente"></button>
        </div>
        <div class="ui-g-6" *ngIf="!newCustomer && !showChangePassword && loggedCustomer.admin" align="right">
          <button type="submit" pButton class="ui-button-success" icon="fa fa-upload" (click)="save()" label="Aggiorna Utente"></button>
        </div>
        <div class="ui-g-6" *ngIf="!newCustomer && showChangePassword" align="right">
          <button type="submit" [disabled]="!customerPassword || !newCustomerPassword || !repeatedNewCustomerPassword"
            pButton class="ui-button-success" icon="fa fa-check" (click)="save(true)" label="Cambia Password"></button>
        </div>
      </div>
    </p-footer>
  </form>
</p-dialog>

<p-dialog [(visible)]="showYDSTMW" [responsive]="true" [modal]="true" [width]="600" [height]="900" [positionTop]="250" [closable]="false">
  <p-header>
    AH Ah Ah! you didn't say the magic word...
  </p-header>
  <div align="center">
    <img src="../../assets/showcase/images/applicationService/magicWord.gif">
  </div>
</p-dialog>

<p-confirmDialog #cd [width]="700">
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <div class="ui-g-3">
        <button type="button" pButton icon="pi pi-times" label="No" (click)="cd.reject()" align="right"></button>
      </div>
      <div class="ui-g-6"></div>
      <div class="ui-g-3">
        <button type="button" pButton icon="pi pi-check" label="Si" (click)="cd.accept()" align="left"></button>
      </div>
    </div>
  </p-footer>
</p-confirmDialog>
